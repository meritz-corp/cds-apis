syntax = "proto3";

package kdo.v1.fund;

import "google/api/annotations.proto";
import "google/api/field_behavior.proto";
import "google/api/resource.proto";
import "google/api/client.proto";

option go_package = "github.com/meritz-corp/cds-apis/go/kdo/v1;kdo";

// FundService는 펀드 관련 서비스를 제공합니다.
service FundService {
  // 단일 펀드 조회
  rpc GetFund(GetFundRequest) returns (Fund) {
    option (google.api.http) = {
      get: "/v1/{fund=funds/*}"
    };
    option (google.api.method_signature) = "fund";
  }

  // 펀드 목록 조회
  rpc ListFunds(ListFundsRequest) returns (ListFundsResponse) {
    option (google.api.http) = {
      get: "/v1/funds"
    };
    option (google.api.method_signature) = "";
  }
}

// 펀드 정보
message Fund {
  // 펀드 코드 (표준 코드)
  string code = 1;
  // 펀드 이름
  string name = 2;
  // 펀드분류코드
  string category_code = 3;
  // 펀드관리직원번호
  string employee_number = 4;
  // 펀드관리직원성명
  string employee_name = 5;
  // 펀드 한도
  string limit_amount = 6;
  // 관리부서코드
  string department_code = 7;
  // 펀드거래구분코드
  string trade_code = 8;
  // 파트구분코드
  string part_code = 9;
  // 상품매매구분코드
  string part_name = 12;
  // 포지션합산여부
  string  product_deal_code = 13;
  // 파트구분명
  string  add_up_position = 14;
  // 트레이딩시스템종류코드
  string trading_system_code = 15;
  // 독립거래단위구분코드
  string unique_trading_unit_code = 16;
  // 독립거래단위파트구분코드
  string unique_trading_unit_part_code = 17;
  // 독립거래단위일련번호
  int64  unique_trading_unit_serial_number = 18;
  // 독립거래단위합산여부
  bool add_up_unique_trading_unit = 19;
  // 공매도ID
  string short_selling_id = 20;
  // 펀드 손익 정보
  FundPnL pnl = 21;
  // 펀드 익스포저 정보
  FundExposure exposure = 22;
}

// 펀드 손익(PnL) 관리
message FundPnL {
  repeated PositionPnL positions = 1;  // 종목별 포지션 PnL 목록
  int64 daily_pnl = 2;                 // 일일 손익
  int64 last_updated_at = 3;           // 마지막 업데이트 시각 (Unix timestamp micros)
}

// 종목별 포지션 PnL
message PositionPnL {
  string symbol = 1;              // 종목 코드
  double average_buy_price = 2;   // 평균 매입가
  int64 quantity = 3;             // 보유 수량
  int64 realized_pnl = 4;         // 실현 손익
  int64 trading_cost = 5;         // 거래 비용
  int64 last_updated_at = 6;      // 마지막 업데이트 시각 (Unix timestamp micros)
}

// 펀드 익스포저(Exposure) 관리
message FundExposure {
  repeated PositionExposure positions = 1;  // 종목별 포지션 수량 목록
  int64 last_updated_at = 2;                // 마지막 업데이트 시각 (Unix timestamp micros)
}

// 종목별 포지션 익스포저
message PositionExposure {
  string symbol = 1;          // 종목 코드
  int64 quantity = 2;         // 보유 수량
  int64 last_updated_at = 3;  // 마지막 업데이트 시각 (Unix timestamp micros)
}


// ========== Request/Response Messages ==========

// GetFund 요청
message GetFundRequest {
  // 펀드 리소스 이름 (예: funds/KR1234567890)
  string fund = 1 [
    (google.api.field_behavior) = REQUIRED,
    (google.api.resource_reference) = {
      type: "kdo.cdsapis.xyz/Fund"
    }
  ];
}

// ListFunds 요청
message ListFundsRequest {
  // 페이지 크기 (optional)
  optional uint32 page_size = 1;

  // 페이지 토큰 (optional, for pagination)
  optional string page_token = 2;

  // Available Sequence and Operator
  // * fund_code
  //   * `equal`, `contains`
  // * employee_name
  //   * `equal`, `contains`
  //
  // Examples
  // * filter=fund_code="0159"
  // * filter=employee_name:"홍길동"
  string filter = 3;
}

// ListFunds 응답
message ListFundsResponse {
  // 펀드 목록
  repeated Fund funds = 1;

  // 다음 페이지 토큰
  string next_page_token = 2;
}
