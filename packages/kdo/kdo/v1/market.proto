syntax = "proto3";

package kdo.v1.market;

import "google/api/annotations.proto";
import "google/api/field_behavior.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/empty.proto";
import "google/api/resource.proto";
import "google/api/client.proto";

option go_package = "github.com/meritz-corp/cds-apis/go/kdo/v1;kdo";

// 주문장 데이터를 스트리밍하는 서비스
service MarketService {
    // ETF 주문장 데이터를 스트리밍
    rpc StreamEtfOrderbook(StreamEtfOrderbookRequest) returns (stream EtfOrderbookData) {
        option (google.api.http) = {
            get: "/v1/market/{etf=etfs/*}/orderbook:stream"
        };
    }

    // 선물 주문장 데이터를 스트리밍
    rpc StreamFuturesOrderbook(StreamFuturesOrderbookRequest) returns (stream FuturesOrderbookData) {
        option (google.api.http) = {
            get: "/v1/market/{future=futures/*}/orderbook:stream"
        };
    }

    // 사용자 주문장 업데이트를 가져오기
    rpc GetUserOrderbook(GetUserOrderBookRequest) returns (UserOrderbookData) {
        option (google.api.http) = {
            get: "/v1/market/{etf=etfs/*}/{fund=funds/*}/user-orderbook"
        };
    }

    // 사용자 주문장 업데이트를 스트리밍
    rpc StreamUserOrderbook(GetUserOrderBookRequest) returns (stream UserOrderbookData) {
        option (google.api.http) = {
            get: "/v1/market/{etf=etfs/*}/{fund=funds/*}/user-orderbook:stream"
        };
    }

    // 주문 접수
    //    rpc PlaceOrder(PlaceOrderRequest) returns (PlaceOrderResponse) {
    //        option (google.api.http) = {
    //            post: "/v1/orders"
    //            body: "*"
    //        };
    //    }
    //
    //    // 주문 취소
    //    rpc CancelOrder(CancelOrderRequest) returns (CancelOrderResponse) {
    //        option (google.api.http) = {
    //            delete: "/v1/orders/{order_id}"
    //        };
    //    }
    //
    //    // 모든 주문 취소
    //    rpc CancelAllOrders(CancelAllOrdersRequest) returns (CancelAllOrdersResponse) {
    //        option (google.api.http) = {
    //            delete: "/v1/orders"
    //        };
    //    }
    //
    //    // 주문 목록 조회
    //    rpc ListOrders(ListOrdersRequest) returns (ListOrdersResponse) {
    //        option (google.api.http) = {
    //            get: "/v1/orders"
    //        };
    //    }


}

// ETF 주문장 스트리밍 요청
message StreamEtfOrderbookRequest {
    // 리소스 이름 (예: etfs/A069500)
    string etf = 1;
}

// 선물 주문장 스트리밍 요청
message StreamFuturesOrderbookRequest {
    // 리소스 이름 (예: futures/K101W9000)
    string future = 1;
}

// 세션 ID 열거형 (AIP-126)
enum SessionId {
    SESSION_ID_UNSPECIFIED = 0; // 기본값
    PREVIOUS = 1;               // 장개시전
    CONNECTED = 2;              // 이상무
    OPENING_ONE_PRICE = 3;      // 시가단일가
    ONE_PRICE = 4;              // 단일가
    CLOSING_ONE_PRICE = 5;      // 종가단일가
    VI_ONE_PRICE = 6;           // VI장중단일가
    VI_OPENING_ONE_PRICE = 7;   // VI시가단일가
    VI_CLOSING_ONE_PRICE = 8;   // VI종가단일가
    UNIT_TRADE = 9;             // 단위매매
    POST_MARKET = 10;           // 장종료후호가접수
    AUCTION_BID = 11;           // 경매매수호가 접수 세션
    AUCTION_ASK = 12;           // 경매매도호가 접수 세션
    SUSPENDED = 13;             // 거래정지
    SHUTDOWN = 14;              // SHUTDOWN
    CLOSED = 15;                // 장마감
    ETC = 16;                   // 기타
}

// ETF 주문장 데이터
message EtfOrderbookData {
    // 매수 호가 (10단계, AIP-144)
    repeated string bid_prices = 1;

    // 매도 호가 (10단계)
    repeated string ask_prices = 2;

    // 매수 수량 (10단계)
    repeated int64 bid_quantities = 3;

    // 매도 수량 (10단계)
    repeated int64 ask_quantities = 4;

    // LP 매수 수량 (10단계)
    repeated int64 lp_bid_quantities = 5;

    // LP 매도 수량 (10단계)
    repeated int64 lp_ask_quantities = 6;

    // 중간 호가
    string mid_price = 7;

    // 중간 매도 수량
    int64 mid_ask_quantity = 8;

    // 중간 매수 수량
    int64 mid_bid_quantity = 9;

    // 총 매도 호가 수량
    int64 ask_quote_total_quantity = 10;

    // 총 매수 호가 수량
    int64 bid_quote_total_quantity = 11;

    // 예상 가격
    string est_price = 12;

    // 예상 거래량
    int64 est_volume = 13;

    // 세션 ID
    SessionId session_id = 14;
}

// 선물 주문장 데이터
message FuturesOrderbookData {
    // 매수 호가 (5단계, AIP-144)
    repeated string bid_prices = 1;

    // 매도 호가 (5단계)
    repeated string ask_prices = 2;

    // 매수 수량 (5단계)
    repeated int64 bid_quantities = 3;

    // 매도 수량 (5단계)
    repeated int64 ask_quantities = 4;

    // 매수 주문 수 (5단계)
    repeated int64 bid_counts = 5;

    // 매도 주문 수 (5단계)
    repeated int64 ask_counts = 6;

    // 총 매도 호가 수량
    int64 ask_quote_total_quantity = 7;

    // 총 매수 호가 수량
    int64 bid_quote_total_quantity = 8;

    // 중간 가격
    string mid_price = 9;

    // 예상 가격
    string est_price = 10;

    // 예상 거래량
    int64 est_volume = 11;

    // 세션 ID
    SessionId session_id = 12;
}

// 주문 타입 열거형
enum OrderType {
    ORDER_TYPE_UNSPECIFIED = 0; // 기본값
    BUY = 1;                    // 매수
    SELL = 2;                   // 매도
}

// 주문 상태 열거형
enum OrderStatus {
    ORDER_STATUS_UNSPECIFIED = 0; // 기본값
    PENDING = 1;                  // 대기중
    PARTIAL_FILLED = 2;           // 부분체결
    FILLED = 3;                   // 체결완료
    CANCELLED = 4;                // 취소됨
    REJECTED = 5;                 // 거부됨
}

// 주문 정보
message Order {
    // 주문 ID
    string order_id = 1;

    // 주문 타입
    OrderType order_type = 2;

    // 상품 (예: etfs/A069500)
    string symbol = 3;

    // 주문 가격
    string price = 4;

    // 주문 수량
    int64 quantity = 5;

    // 체결 수량
    int64 filled_quantity = 6;

    // 주문 상태
    OrderStatus status = 7;

    // 주문 시간 (Unix timestamp)
    int64 created_at = 8;

    // 업데이트 시간 (Unix timestamp)
    int64 updated_at = 9;
}

// 주문 접수 요청
message PlaceOrderRequest {
    // 주문 타입
    OrderType order_type = 1;

    // 상품 (예: etfs/A069500)
    string symbol = 2;

    // 주문 가격
    string price = 3;

    // 주문 수량
    int64 quantity = 4;
}

// 주문 접수 응답
message PlaceOrderResponse {
    // 생성된 주문 정보
    Order order = 1;
}

// 주문 취소 요청
message CancelOrderRequest {
    // 취소할 주문 ID
    string order_id = 1;
}

// 주문 취소 응답
message CancelOrderResponse {
    // 취소된 주문 정보
    Order order = 1;
}

// 모든 주문 취소 요청
message CancelAllOrdersRequest {
    // 선택적: 특정 상품의 주문만 취소
    string symbol = 1;
}

// 모든 주문 취소 응답
message CancelAllOrdersResponse {
    // 취소된 주문 수
    int32 cancelled_count = 1;

    // 취소된 주문 목록
    repeated Order cancelled_orders = 2;
}

// 주문 목록 조회 요청
message ListOrdersRequest {
    // 필터링 조건 (선택적, AIP-160)
    string filter = 1;

    // 페이징 (AIP-158)
    int32 page_size = 2;
    string page_token = 3;
}

// 주문 목록 조회 응답
message ListOrdersResponse {
    // 주문 목록
    repeated Order orders = 1;

    // 다음 페이지 토큰 (AIP-158)
    string next_page_token = 2;
}

// 주문 업데이트 스트리밍 요청
message GetUserOrderBookRequest {
    string etf = 1 [
        (google.api.field_behavior) = REQUIRED,
        (google.api.resource_reference) = {
            type: "kdo.cdsapis.xyz/Etf"
        }
    ];

    string fund = 2 [
        (google.api.field_behavior) = REQUIRED,
        (google.api.resource_reference) = {
            type: "kdo.cdsapis.xyz/Fund"
        }
    ];
}

// 주문 업데이트 정보
message UserOrderbookData {
    // 매수 호가 (10단계, AIP-144)
    repeated string bid_prices = 1;

    // 매도 호가 (10단계)
    repeated string ask_prices = 2;

    // 매수 수량 (10단계)
    repeated int64 bid_quantities = 3;

    // 매도 수량 (10단계)
    repeated int64 ask_quantities = 4;
}