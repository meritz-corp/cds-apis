syntax = "proto3";

package kdo.v1.etf;

import "google/api/annotations.proto";
import "google/api/field_behavior.proto";
import "google/protobuf/timestamp.proto";
import "google/protobuf/field_mask.proto";
import "google/protobuf/empty.proto";
import "google/api/resource.proto";
import "google/api/client.proto";

option go_package = "github.com/meritz-corp/cds-apis/go/kdo/v1;kdo";

// EtfService는 ETF 및 선물 관련 서비스를 제공합니다.
service EtfService {
    rpc GetEtf(GetEtfRequest) returns (Etf) {
        option (google.api.http) = {
            get: "/v1/{etf=etfs/*}"
        };
        option (google.api.method_signature) = "etf";
    }

    rpc ListEtfs(ListEtfsRequest) returns (ListEtfsResponse) {
        option (google.api.http) = {
            get: "/v1/etfs"
        };
        option (google.api.method_signature) = "";
    }
}


message Etf {
    // ETF ID
    uint64 id = 1;

    // ETF 심볼 (ISIN 코드)
    string symbol = 2;

    // ETF 이름
    string name = 3;

    // 마지막 가격
    string last_price = 4;

    // PDF 구성 종목 목록
    map<string, EtfPdfConstituent> constituents = 5;

    // NAV 정보
    EtfNav nav = 6;

    // 설정 단위
    int64 creation_unit = 8;

    // Tick 크기 (원 단위, i64)
    int64 tick_size = 9;

    // 복제 방법
    ReplicationMethod replication_method = 10;
}

// PDF 구성 종목
message EtfPdfConstituent {
    // 종목 코드
    string symbol = 1;  // symbol

    // 종목명
    string name = 2;

    // 상품 타입
    ProductType product_type = 3;

    // 구성 수량 (선물 숏의 경우 음수)
    int64 quantity = 4;
}

// 상품 타입
enum ProductType {
    PRODUCT_TYPE_UNSPECIFIED = 0;
    PRODUCT_TYPE_STOCK = 1;
    PRODUCT_TYPE_FUTURES = 2;
    PRODUCT_TYPE_ETF = 3;
}

// ETF NAV 정보
message EtfNav {
    oneof nav_type {
        PhysicalNav physical = 1;
        FuturesBasedNav futures_based = 2;
    }
}

// 현물 기반 NAV
message PhysicalNav {
    // 마지막 NAV (원 단위, i64)
    string last_nav = 1;

    // 구성종목별 가격 정보
    map<string, ConstituentPrice> constituents = 2;
}

// 선물 기반 NAV
message FuturesBasedNav {
    // 마지막 NAV (원 단위, i64)
    string last_nav = 1;

    // 전일 NAV
    string prior_day_nav = 2;

    // 레버리지 배수
    double leverage_multiplier = 3;

    // 선물 심볼
    string futures_symbol = 4;

    // 선물 전일 가격
    string futures_prior_day_price = 5;

    // 선물 현재 가격
    string futures_last_price = 6;
}

// 구성종목 가격 정보
message ConstituentPrice {
    // 마지막 가격 (원 단위, i64)
    string last_price = 1;

    // 구성 수량
    int64 quantity = 2;
}

// 복제 방법
enum ReplicationMethod {
    REPLICATION_METHOD_UNSPECIFIED = 0;
    REPLICATION_METHOD_PHYSICAL = 1;
    REPLICATION_METHOD_SYNTHETIC = 2;
    REPLICATION_METHOD_FUTURES_BASED = 3;
}

// ========== Request/Response Messages ==========

// GetEtf
message GetEtfRequest {
    string etf = 1 [
        (google.api.field_behavior) = REQUIRED,
        (google.api.resource_reference) = {
            type: "kdo.cdsapis.xyz/Etf"
        }
    ];
}

// ListEtfs
message ListEtfsRequest {
    // 페이지 크기 (optional)
    optional uint32 page_size = 1;

    // 페이지 토큰 (optional, for pagination)
    optional string page_token = 2;

    // 필터링 조건 (optional, AIP-160)
    string filter = 3;
}

message ListEtfsResponse {
    // ETF 목록
    repeated Etf etfs = 1;

    // 다음 페이지 토큰
    string next_page_token = 2;
}
